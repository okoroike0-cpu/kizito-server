<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OmniFetch | Universal Media Pathfinder</title>
    <meta name="description" content="OmniFetch â€” Download any video or audio instantly from YouTube, Vimeo, Dailymotion and more. Universal Media Pathfinder.">

    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/2583/2583434.png">

    <!--
        FIX 7: Apply saved theme BEFORE any CSS renders to prevent flash of light theme (FOUC).
        This tiny script runs synchronously in <head>, before the browser paints anything.
    -->
    <script>
        (function() {
            const saved = localStorage.getItem('omni_theme');
            if (saved) document.documentElement.setAttribute('data-theme', saved);
        })();
    </script>

    <!--
        FIX 6: socket.io with onerror fallback.
        If the CDN is down, io() would be undefined and kizito2.js crashes entirely
        on line 8 with ReferenceError â€” killing fetchVideo, history, everything.
    -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"
            onerror="window._socketIOFailed=true;console.error('socket.io CDN failed')"></script>

    <!-- FIX 4: Removed jszip â€” it was imported but never used, adding ~100KB for nothing -->

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/abtp2/csplayer@latest/dist/csplayer.min.css">
    <script src="https://cdn.jsdelivr.net/gh/abtp2/csplayer@latest/dist/csplayer.min.js"></script>

    <style>
        :root {
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333333;
            --border-color: #dddddd;
            --input-bg: #ffffff;
            --accent: #007bff;
            --accent-hover: #0056b3;
            --step-bg: #eef2f3;
            --status-offline: #e74c3c;
            --status-online: #2ecc71;
            --success-glow: rgba(46, 204, 113, 0.6);
        }

        [data-theme="dark"] {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --border-color: #444444;
            --input-bg: #2d2d2d;
            --step-bg: #252525;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0; padding: 0;
            transition: background-color 0.3s, color 0.3s;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        .container { display: flex; flex-direction: column; align-items: center; padding: 40px 15px 60px; }

        .header-box {
            display: flex; align-items: center; justify-content: center;
            gap: 8px; padding: 10px 20px; border-radius: 12px;
            transition: all 0.3s ease; cursor: pointer; text-decoration: none;
            user-select: none;
        }
        .header-box:hover {
            background: var(--step-bg);
            box-shadow: 0 8px 20px rgba(0, 123, 255, 0.2);
            transform: translateY(-2px);
        }

        .card {
            background: var(--card-bg); padding: 30px; border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 500px;
            margin-bottom: 20px; position: relative;
        }

        .input-row { display: flex; gap: 10px; margin: 20px 0; }
        input[type="text"] {
            flex: 1; padding: 14px; border-radius: 8px; border: 1px solid var(--border-color);
            background: var(--input-bg); color: var(--text-color); font-size: 16px;
            outline: none; transition: border-color 0.2s; width: 100%;
        }
        input[type="text"]:focus { border-color: var(--accent); }

        #startBtn {
            cursor: pointer; border: none; padding: 12px 25px; border-radius: 8px;
            font-weight: bold; background: var(--accent); color: white;
            display: flex; align-items: center; justify-content: center; gap: 6px;
            transition: all 0.2s ease; white-space: nowrap; flex-shrink: 0;
        }
        #startBtn:hover:not(:disabled) { background: var(--accent-hover); transform: translateY(-1px); }
        #startBtn:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }

        #downloadBtn {
            width: 100%; background: #28a745; padding: 14px 25px; border: none;
            color: white; font-size: 15px; font-weight: bold; cursor: pointer;
            border-radius: 8px; transition: transform 0.2s ease, background 0.2s;
            animation: pulse-green 2s infinite;
        }
        #downloadBtn:hover:not(:disabled) { background: #218838; transform: translateY(-1px); }
        #downloadBtn:disabled { background: #6c757d; animation: none; cursor: not-allowed; }

        #videoPreview {
            width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 8px;
            margin-bottom: 15px; overflow: hidden;
            display: flex; align-items: center; justify-content: center;
        }
        #videoPreview img { width: 100%; height: 100%; object-fit: cover; }

        .search-row { display: flex; gap: 8px; margin-bottom: 15px; }
        .search-row input {
            flex: 1; padding: 10px 14px; border-radius: 8px;
            border: 1px solid var(--border-color); background: var(--input-bg);
            color: var(--text-color); font-size: 14px; outline: none;
        }
        .search-row input:focus { border-color: var(--accent); }
        #searchBtn {
            padding: 10px 18px; background: var(--accent); color: white;
            border: none; border-radius: 8px; font-weight: bold; cursor: pointer;
            font-size: 13px; white-space: nowrap; transition: background 0.2s;
        }
        #searchBtn:hover { background: var(--accent-hover); }

        #trendingSection { width: 100%; max-width: 500px; margin-top: 10px; margin-bottom: 25px; }
        #trendingGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 12px;
        }

        .movie-card {
            background: var(--card-bg); border-radius: 10px; overflow: hidden;
            transition: transform 0.3s ease, border-color 0.3s ease;
            cursor: pointer; border: 1px solid var(--border-color);
        }
        .movie-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        .movie-poster { width: 100%; aspect-ratio: 2/3; object-fit: cover; display: block; }
        .movie-info {
            padding: 6px; font-size: 11px; font-weight: bold; text-align: center;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        .share-btn {
            background: none; border: 1px solid var(--border-color);
            color: var(--text-color); padding: 10px; font-size: 12px;
            margin-top: 15px; width: 100%; opacity: 0.8;
            transition: all 0.2s; border-radius: 8px; cursor: pointer; font-weight: bold;
        }
        .share-btn:hover { opacity: 1; background: var(--step-bg); border-color: var(--accent); }

        .feedback-link {
            display: block; text-align: center; font-size: 11px; margin-top: 15px;
            color: var(--text-color); opacity: 0.5; text-decoration: none; transition: 0.2s;
        }
        .feedback-link:hover { opacity: 1; color: var(--accent); }

        @keyframes pulse-green {
            0%   { box-shadow: 0 0 0 0 var(--success-glow); }
            70%  { box-shadow: 0 0 0 15px rgba(46, 204, 113, 0); }
            100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
        }

        .guide-section { width: 100%; max-width: 500px; margin-top: 10px; margin-bottom: 25px; }
        .guide-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .step-card {
            background: var(--step-bg); padding: 15px; border-radius: 10px;
            font-size: 13px; border-left: 4px solid var(--accent); line-height: 1.4;
        }

        .status-dot {
            height: 8px; width: 8px; border-radius: 50%; display: inline-block;
            margin-right: 5px; background-color: #e74c3c; flex-shrink: 0;
        }

        .spinner {
            border: 2px solid #ffffff4d; border-top: 2px solid #fff;
            border-radius: 50%; width: 16px; height: 16px;
            animation: spin 1s linear infinite; display: none;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        #historySection { width: 100%; max-width: 500px; margin-top: 10px; display: none; }
        .history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }

        .history-item {
            background: var(--card-bg); padding: 15px; border-radius: 12px;
            margin-bottom: 10px; cursor: pointer; border: 1px solid var(--border-color);
            transition: all 0.2s ease;
            display: flex; justify-content: space-between; align-items: center;
        }
        .history-item:hover {
            border-color: var(--accent);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .copy-badge {
            background: var(--step-bg); color: var(--accent);
            padding: 4px 8px; border-radius: 6px; font-size: 10px;
            font-weight: bold; border: 1px solid var(--border-color);
            transition: 0.2s; flex-shrink: 0;
        }
        .copy-badge:hover { background: var(--accent); color: white; }

        .clear-btn {
            background: none; border: 1px solid transparent;
            color: var(--status-offline); font-size: 11px; padding: 5px 10px;
            opacity: 0.7; transition: all 0.2s; cursor: pointer; border-radius: 5px;
        }
        .clear-btn:hover { opacity: 1; background: rgba(231,76,60,0.1); border-color: var(--status-offline); }

        #sourceIndicator {
            display: none; font-size: 10px; background: var(--accent); color: white;
            padding: 2px 8px; border-radius: 4px; font-weight: bold; flex-shrink: 0;
        }

        select {
            width: 100%; margin: 15px 0; padding: 12px;
            border-radius: 8px; background: var(--input-bg);
            color: var(--text-color); border: 1px solid var(--border-color);
            font-size: 14px; outline: none; cursor: pointer;
        }
        select:focus { border-color: var(--accent); }

        /* FIX 2: Theme button position:fixed so it stays visible when page scrolls on mobile */
        .theme-btn-wrap {
            position: fixed;
            top: 15px; right: 15px;
            z-index: 1000;
        }

        @media (max-width: 600px) {
            .container { padding: 20px 10px 60px; }
            .card { padding: 20px; border-radius: 10px; }
            h1 { font-size: 24px; }
            .input-row { flex-direction: column; }
            .guide-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <!-- FIX 2: Changed position:absolute â†’ position:fixed via .theme-btn-wrap class -->
    <div class="theme-btn-wrap">
        <button id="themeToggle" style="padding:8px 15px;font-size:12px;background:var(--card-bg);color:var(--text-color);border:1px solid var(--border-color);cursor:pointer;border-radius:8px;font-weight:bold;">ðŸŒ™ Mode</button>
    </div>

    <!-- FIX 5: noscript fallback so non-JS users see something useful -->
    <noscript>
        <div style="text-align:center;padding:60px 20px;font-family:sans-serif;">
            <h2>OmniFetch requires JavaScript</h2>
            <p>Please enable JavaScript in your browser to use OmniFetch.</p>
        </div>
    </noscript>

    <div class="container">
        <div class="card">
            <a href="/" class="header-box">
                <div id="statusDot" class="status-dot" title="Connecting..."></div>
                <h1 style="margin:0;color:var(--accent);font-size:28px;">OmniFetch</h1>
            </a>
            <p style="text-align:center;font-size:13px;opacity:0.7;margin-top:5px;margin-bottom:0;">Universal Media Pathfinder</p>

            <div class="input-row">
                <input type="text" id="videoUrl" placeholder="Paste link or type video name..." autocomplete="off" />
                <button onclick="fetchVideo()" id="startBtn">
                    <span id="btnText">Fetch</span>
                    <div id="spinner" class="spinner"></div>
                </button>
            </div>

            <div id="progressText" style="display:none;font-size:12px;margin-bottom:5px;text-align:center;"></div>
            <div id="progressWrapper" style="display:none;background:var(--border-color);height:6px;border-radius:3px;overflow:hidden;margin-bottom:15px;">
                <div id="progressBar" style="width:0%;height:100%;background:#2ecc71;transition:width 0.3s ease;"></div>
            </div>

            <div id="errorBox" style="display:none;color:#e74c3c;background:rgba(231,76,60,0.1);padding:10px;border-radius:5px;font-size:13px;margin-bottom:15px;text-align:center;border:1px solid #e74c3c;"></div>

            <div id="result" style="display:none;">
                <div id="videoPreview"></div>
                <div class="meta">
                    <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:10px;">
                        <strong id="title" style="font-size:14px;line-height:1.4;flex:1;">Media Title</strong>
                        <span id="sourceIndicator"></span>
                    </div>
                    <select id="formatSelect">
                        <option value="1080">ðŸ“¹ MP4 Video â€” HD 1080p</option>
                        <option value="720">ðŸ“¹ MP4 Video â€” 720p</option>
                        <option value="480" selected>ðŸ“¹ MP4 Video â€” 480p (Recommended)</option>
                        <option value="360">ðŸ“¹ MP4 Video â€” 360p (Light)</option>
                        <option value="240">ðŸ“¹ MP4 Video â€” 240p (Save Data)</option>
                        <option value="mp3">ðŸŽµ MP3 Audio â€” High Quality</option>
                    </select>
                    <button id="downloadBtn" onclick="triggerDownload()">â¬‡ Download Now</button>
                </div>
            </div>

            <button class="share-btn" onclick="shareSite()">ðŸ”— Share OmniFetch</button>
            <a href="mailto:okoroike0@gmail.com?subject=OmniFetch Bug Report" class="feedback-link">âœ‰ Report Bug / Feedback</a>
        </div>

        <div id="trendingSection">
            <h3 style="font-size:14px;opacity:0.7;margin-bottom:10px;text-transform:uppercase;letter-spacing:1px;">ðŸ”¥ Trending Today</h3>
            <div class="search-row">
                <input type="text" id="searchInput" placeholder="Search movies..." autocomplete="off">
                <button id="searchBtn">Search</button>
            </div>
            <div id="trendingGrid"></div>
        </div>

        <div class="guide-section">
            <h3 style="font-size:14px;opacity:0.7;margin-bottom:15px;text-transform:uppercase;letter-spacing:1px;">âš™ How it Works</h3>
            <div class="guide-grid">
                <div class="step-card"><strong>1. Dispatch</strong><br>Enter a link or name. Our scavenger bots start the hunt.</div>
                <div class="step-card"><strong>2. Scavenge</strong><br>We bypass trackers to find the cleanest high-speed stream.</div>
                <div class="step-card"><strong>3. Convert</strong><br>Files are processed into your chosen format instantly.</div>
                <div class="step-card"><strong>4. Claim</strong><br>Download directly to your device. No ads, no redirects.</div>
            </div>
        </div>

        <div id="historySection">
            <div class="history-header">
                <h3 style="font-size:14px;opacity:0.7;margin:0;text-transform:uppercase;letter-spacing:1px;">ðŸ•˜ Recent Fetches</h3>
                <button onclick="clearHistory()" class="clear-btn">Clear All</button>
            </div>
            <div id="historyList"></div>
        </div>
    </div>

    <!--
        FIX 6: If socket.io CDN failed (onerror above set window._socketIOFailed),
        define a dummy io() so kizito2.js doesn't crash â€” app works without real-time progress.
    -->
    <script>
        if (window._socketIOFailed || typeof io === 'undefined') {
            console.warn('socket.io unavailable â€” defining stub so app still works');
            window.io = function() {
                return {
                    on: function() {},
                    emit: function() {},
                    connected: false,
                    id: ''
                };
            };
        }
    </script>

    <script src="kizito2.js"></script>
</body>
</html>