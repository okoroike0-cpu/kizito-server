<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OmniFetch | Video &amp; Music Downloader</title>
    <meta name="description" content="Download videos and music from YouTube, Dailymotion, TikTok, Facebook, Instagram, Vimeo and more.">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/2583/2583434.png">

    <script>(function(){const s=localStorage.getItem('omni_theme');if(s)document.documentElement.setAttribute('data-theme',s);})();</script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js" onerror="window._socketIOFailed=true"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/abtp2/csplayer@latest/dist/csplayer.min.css">
    <script src="https://cdn.jsdelivr.net/gh/abtp2/csplayer@latest/dist/csplayer.min.js"></script>

    <style>
        :root {
            --bg:      #f0f2f5;
            --card:    #ffffff;
            --text:    #1a1a2e;
            --sub:     #555577;
            --border:  #e0e0ee;
            --input:   #ffffff;
            --accent:  #4f46e5;
            --accentH: #3730a3;
            --green:   #16a34a;
            --greenH:  #15803d;
            --blue:    #2563eb;
            --blueH:   #1d4ed8;
            --red:     #dc2626;
            --muted:   #f3f4f8;
            --glow:    rgba(22,163,74,0.4);
        }
        [data-theme="dark"] {
            --bg:    #0f0f1a;
            --card:  #1a1a2e;
            --text:  #e8e8f0;
            --sub:   #9090b0;
            --border:#2a2a45;
            --input: #252540;
            --muted: #1e1e35;
        }
        *{box-sizing:border-box;margin:0;padding:0;}
        body{background:var(--bg);color:var(--text);font-family:'Segoe UI',system-ui,sans-serif;min-height:100vh;}
        .page{display:flex;flex-direction:column;align-items:center;padding:36px 14px 80px;}
        .header-card{background:var(--card);border-radius:18px;box-shadow:0 8px 32px rgba(0,0,0,.08);
                     width:100%;max-width:580px;padding:28px 28px 24px;margin-bottom:16px;}
        .logo-row{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:6px;text-decoration:none;}
        .status-dot{width:9px;height:9px;border-radius:50%;background:var(--red);flex-shrink:0;transition:background .4s;}
        h1{color:var(--accent);font-size:30px;font-weight:800;letter-spacing:-.5px;}
        .tagline{text-align:center;font-size:13px;color:var(--sub);margin-bottom:20px;}
        .search-row{display:flex;gap:10px;}
        .search-row input{flex:1;padding:14px 16px;border-radius:10px;border:1.5px solid var(--border);
                          background:var(--input);color:var(--text);font-size:15px;outline:none;transition:border-color .2s;}
        .search-row input:focus{border-color:var(--accent);}
        .search-row input::placeholder{color:var(--sub);}
        #clearBtn{cursor:pointer;border:none;padding:13px 14px;border-radius:10px;font-weight:700;
                  font-size:15px;background:var(--muted);color:var(--sub);transition:all .2s;
                  flex-shrink:0;display:none;line-height:1;}
        #clearBtn:hover{background:rgba(220,38,38,.12);color:var(--red);}
        #startBtn{cursor:pointer;border:none;padding:13px 22px;border-radius:10px;font-weight:700;
                  font-size:14px;background:var(--accent);color:#fff;display:flex;align-items:center;
                  gap:7px;transition:all .2s;white-space:nowrap;flex-shrink:0;}
        #startBtn:hover:not(:disabled){background:var(--accentH);transform:translateY(-1px);}
        #startBtn:disabled{opacity:.6;cursor:not-allowed;transform:none;}
        .spinner{border:2px solid #fff4;border-top:2px solid #fff;border-radius:50%;
                 width:15px;height:15px;animation:spin 1s linear infinite;display:none;}
        @keyframes spin{to{transform:rotate(360deg);}}
        .hint{font-size:11.5px;color:var(--sub);margin-top:10px;text-align:center;line-height:1.5;}
        .hint span{background:var(--muted);padding:2px 7px;border-radius:5px;margin:0 2px;font-weight:600;}
        .prog-wrap{display:none;background:var(--border);height:5px;border-radius:3px;overflow:hidden;margin-top:14px;}
        .prog-bar{width:0%;height:100%;background:var(--green);transition:width .3s;}
        .prog-txt{display:none;font-size:12px;text-align:center;margin-top:6px;color:var(--sub);}
        .error-box{display:none;color:var(--red);background:rgba(220,38,38,.07);border:1px solid rgba(220,38,38,.3);
                   padding:10px 14px;border-radius:9px;font-size:13px;margin-top:12px;text-align:center;}
        #searchResults{width:100%;max-width:580px;margin-bottom:16px;display:none;}
        .results-label{font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;
                        color:var(--sub);margin-bottom:10px;}
        .result-item{background:var(--card);border:1px solid var(--border);border-radius:12px;
                     padding:14px 16px;margin-bottom:10px;display:flex;align-items:center;gap:12px;
                     transition:border-color .2s,box-shadow .2s;}
        .result-item:hover{border-color:var(--accent);box-shadow:0 4px 16px rgba(79,70,229,.1);}
        .result-thumb{width:72px;height:48px;border-radius:7px;object-fit:cover;flex-shrink:0;background:var(--muted);}
        .result-thumb-ph{width:72px;height:48px;border-radius:7px;background:var(--muted);flex-shrink:0;
                          display:flex;align-items:center;justify-content:center;font-size:22px;}
        .result-info{flex:1;min-width:0;}
        .result-title{font-size:13px;font-weight:700;overflow:hidden;text-overflow:ellipsis;
                       white-space:nowrap;margin-bottom:5px;line-height:1.3;}
        .result-meta{font-size:11px;color:var(--sub);}
        .result-actions{display:flex;gap:6px;flex-shrink:0;flex-wrap:wrap;justify-content:flex-end;}
        .btn-mp3{padding:6px 11px;border:none;border-radius:7px;font-size:11px;font-weight:700;
                  cursor:pointer;background:var(--green);color:#fff;transition:all .15s;white-space:nowrap;}
        .btn-mp3:hover{background:var(--greenH);transform:translateY(-1px);}
        .btn-mp4{padding:6px 11px;border:none;border-radius:7px;font-size:11px;font-weight:700;
                  cursor:pointer;background:var(--blue);color:#fff;transition:all .15s;white-space:nowrap;}
        .btn-mp4:hover{background:var(--blueH);transform:translateY(-1px);}
        .btn-play{padding:6px 11px;border:1.5px solid var(--border);border-radius:7px;font-size:11px;
                   font-weight:700;cursor:pointer;background:var(--card);color:var(--text);
                   transition:all .15s;white-space:nowrap;}
        .btn-play:hover{border-color:var(--accent);color:var(--accent);}
        .btn-busy{opacity:.6;cursor:not-allowed !important;transform:none !important;}
        #downloadCard{background:var(--card);border-radius:18px;box-shadow:0 8px 32px rgba(0,0,0,.08);
                      width:100%;max-width:580px;padding:24px;margin-bottom:16px;display:none;}
        #videoPreview{width:100%;aspect-ratio:16/9;background:#000;border-radius:10px;
                      margin-bottom:14px;overflow:hidden;display:flex;align-items:center;justify-content:center;}
        #videoPreview img{width:100%;height:100%;object-fit:cover;}
        .media-title-row{display:flex;justify-content:space-between;align-items:flex-start;gap:8px;margin-bottom:4px;}
        #dlTitle{font-size:15px;font-weight:700;line-height:1.4;flex:1;}
        #sourceChip{display:none;font-size:10px;background:var(--accent);color:#fff;
                    padding:2px 9px;border-radius:5px;font-weight:700;flex-shrink:0;white-space:nowrap;}
        #dlMeta{font-size:11.5px;color:var(--sub);margin-bottom:12px;line-height:1.5;}
        #formatSelect{width:100%;margin:0 0 10px;padding:11px 12px;border-radius:9px;
                       background:var(--input);color:var(--text);border:1.5px solid var(--border);
                       font-size:13px;outline:none;cursor:pointer;}
        #formatSelect:focus{border-color:var(--accent);}
        #downloadBtn{width:100%;background:var(--green);padding:13px;border:none;color:#fff;
                     font-size:15px;font-weight:700;cursor:pointer;border-radius:10px;
                     transition:transform .2s,background .2s;animation:pulseG 2s infinite;}
        #downloadBtn:hover:not(:disabled){background:var(--greenH);transform:translateY(-1px);}
        #downloadBtn:disabled{background:#6b7280;animation:none;cursor:not-allowed;}
        @keyframes pulseG{0%{box-shadow:0 0 0 0 var(--glow);}70%{box-shadow:0 0 0 13px rgba(22,163,74,0);}100%{box-shadow:0 0 0 0 rgba(22,163,74,0);}}
        #miniPlayer{display:none;position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
                    background:var(--card);border:1px solid var(--border);border-radius:14px;
                    box-shadow:0 12px 40px rgba(0,0,0,.2);padding:14px 18px;width:94%;max-width:540px;z-index:500;}
        #miniPlayer .mp-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
        #miniPlayerTitle{font-size:13px;font-weight:700;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1;}
        #miniPlayerClose{background:none;border:none;font-size:18px;cursor:pointer;color:var(--sub);padding:0 4px;}
        #miniPlayerInner{width:100%;aspect-ratio:16/9;background:#000;border-radius:8px;overflow:hidden;}
        .platforms{display:flex;flex-wrap:wrap;gap:7px;justify-content:center;
                   width:100%;max-width:580px;margin-bottom:20px;}
        .ptag{font-size:11px;font-weight:700;padding:4px 12px;border-radius:20px;
              border:1px solid var(--border);background:var(--card);color:var(--sub);}
        .guide{width:100%;max-width:580px;margin-bottom:22px;}
        .guide-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
        .step{background:var(--card);border:1px solid var(--border);padding:14px;border-radius:11px;
              font-size:13px;border-left:4px solid var(--accent);line-height:1.45;color:var(--text);}
        .step strong{display:block;margin-bottom:3px;}
        #historySection{width:100%;max-width:580px;display:none;margin-top:4px;}
        .hist-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
        .hist-item{background:var(--card);padding:12px 14px;border-radius:11px;margin-bottom:8px;
                   cursor:pointer;border:1px solid var(--border);transition:all .2s;display:flex;align-items:center;}
        .hist-item:hover{border-color:var(--accent);transform:translateY(-2px);box-shadow:0 4px 14px rgba(0,0,0,.08);}
        .hist-thumb{width:56px;height:34px;object-fit:cover;border-radius:5px;flex-shrink:0;}
        .hist-no-thumb{width:56px;height:34px;background:var(--muted);border-radius:5px;
                       display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0;}
        .hist-label{font-weight:700;font-size:13px;overflow:hidden;text-overflow:ellipsis;
                    white-space:nowrap;flex:1;margin:0 10px;}
        .refetch-badge{background:var(--muted);color:var(--accent);padding:3px 8px;border-radius:6px;
                       font-size:10px;font-weight:700;border:1px solid var(--border);flex-shrink:0;}
        .clear-btn{background:none;border:1px solid transparent;color:var(--red);font-size:11px;
                   padding:4px 9px;opacity:.65;transition:all .2s;cursor:pointer;border-radius:5px;}
        .clear-btn:hover{opacity:1;background:rgba(220,38,38,.08);border-color:var(--red);}
        .share-btn{background:none;border:1px solid var(--border);color:var(--text);padding:9px;
                   font-size:12px;margin-top:12px;width:100%;opacity:.7;transition:all .2s;
                   border-radius:9px;cursor:pointer;font-weight:700;}
        .share-btn:hover{opacity:1;background:var(--muted);border-color:var(--accent);}
        .feedback-link{display:block;text-align:center;font-size:11px;margin-top:10px;
                        color:var(--sub);opacity:.6;text-decoration:none;transition:.2s;cursor:pointer;}
        .feedback-link:hover{opacity:1;color:var(--accent);}
        #themeToggle{position:fixed;top:14px;right:14px;z-index:999;padding:7px 13px;
                     font-size:12px;font-weight:700;background:var(--card);color:var(--text);
                     border:1px solid var(--border);cursor:pointer;border-radius:8px;
                     box-shadow:0 2px 8px rgba(0,0,0,.08);}

        /* â”€â”€ Auth button (fixed top-left, mirrors themeToggle style) â”€â”€ */
        #authBtn {
            position:fixed;top:14px;left:14px;z-index:999;
            padding:7px 13px;font-size:12px;font-weight:700;
            background:var(--card);color:var(--text);
            border:1px solid var(--border);cursor:pointer;border-radius:8px;
            box-shadow:0 2px 8px rgba(0,0,0,.08);
            transition:all .2s;display:flex;align-items:center;gap:5px;
        }
        #authBtn:hover{background:var(--muted);border-color:var(--accent);}
        #authBtn .auth-dot{
            width:7px;height:7px;border-radius:50%;background:var(--red);
            flex-shrink:0;transition:background .4s;
        }
        #authBtn.linked .auth-dot{background:var(--green);}
        #authBtn.linked{color:var(--green);border-color:rgba(22,163,74,.35);}

        /* â”€â”€ Auth modal overlay â”€â”€ */
        #authModal{
            display:none;position:fixed;inset:0;z-index:1100;
            background:rgba(0,0,0,.55);backdrop-filter:blur(3px);
            align-items:center;justify-content:center;
        }
        #authModal.open{display:flex;}

        .auth-modal-box{
            background:var(--card);color:var(--text);
            border-radius:18px;box-shadow:0 12px 48px rgba(0,0,0,.35);
            border:1px solid var(--border);
            width:92%;max-width:420px;padding:28px 26px;
            position:relative;animation:slideUp .22s ease;
        }
        @keyframes slideUp{from{transform:translateY(18px);opacity:0;}to{transform:translateY(0);opacity:1;}}

        .auth-modal-close{
            position:absolute;top:14px;right:16px;
            background:none;border:none;font-size:18px;
            cursor:pointer;color:var(--sub);line-height:1;
            padding:2px 6px;border-radius:5px;transition:background .15s;
        }
        .auth-modal-close:hover{background:var(--muted);}

        .auth-modal-box h3{font-size:16px;font-weight:800;margin-bottom:4px;}
        .auth-modal-subtitle{font-size:12px;color:var(--sub);margin-bottom:18px;line-height:1.5;}

        /* Status pill */
        .auth-status-pill{
            display:flex;align-items:center;gap:8px;
            background:var(--muted);border:1px solid var(--border);
            border-radius:9px;padding:10px 13px;
            font-size:12.5px;margin-bottom:16px;line-height:1.45;
        }
        .auth-status-pill .pill-dot{
            width:8px;height:8px;border-radius:50%;flex-shrink:0;
            background:var(--sub);transition:background .3s;
        }
        .auth-status-pill.linked   .pill-dot{background:var(--green);}
        .auth-status-pill.pending  .pill-dot{background:#f59e0b;animation:blink 1.1s ease-in-out infinite;}
        .auth-status-pill.error    .pill-dot{background:var(--red);}
        @keyframes blink{0%,100%{opacity:1;}50%{opacity:.3;}}

        /* Device-code steps */
        #authSteps{display:none;margin-bottom:16px;}
        .auth-step-row{
            display:flex;align-items:flex-start;gap:10px;
            font-size:12.5px;margin-bottom:10px;color:var(--text);line-height:1.45;
        }
        .auth-step-num{
            background:var(--accent);color:#fff;border-radius:50%;
            width:20px;height:20px;font-size:11px;font-weight:800;flex-shrink:0;
            display:flex;align-items:center;justify-content:center;margin-top:1px;
        }
        .auth-code-block{
            background:var(--muted);border:1px solid var(--border);
            border-radius:10px;padding:12px 16px;
            display:flex;align-items:center;justify-content:space-between;
            margin:0 0 14px 30px;
        }
        #authUserCode{
            font-family:monospace;font-size:1.5rem;
            letter-spacing:.14em;font-weight:800;color:var(--accent);
        }
        .auth-copy-btn{
            padding:5px 11px;border:none;border-radius:7px;
            background:var(--accent);color:#fff;
            font-size:11px;font-weight:700;cursor:pointer;
            transition:opacity .15s;
        }
        .auth-copy-btn:hover{opacity:.85;}
        .auth-waiting{
            text-align:center;font-size:12px;color:var(--sub);
            margin-bottom:14px;animation:blink 1.4s ease-in-out infinite;
        }

        /* Action buttons */
        .auth-btn-row{display:flex;gap:9px;margin-bottom:14px;}
        .auth-btn-primary{
            flex:1;padding:11px;border:none;border-radius:10px;
            background:var(--accent);color:#fff;
            font-size:13px;font-weight:700;cursor:pointer;
            transition:background .2s,transform .15s;
        }
        .auth-btn-primary:hover:not(:disabled){background:var(--accentH);transform:translateY(-1px);}
        .auth-btn-primary:disabled{opacity:.5;cursor:not-allowed;transform:none;}
        .auth-btn-danger{
            flex:1;padding:11px;border:1.5px solid var(--red);border-radius:10px;
            background:transparent;color:var(--red);
            font-size:13px;font-weight:700;cursor:pointer;
            transition:background .2s;
        }
        .auth-btn-danger:hover{background:rgba(220,38,38,.08);}

        .auth-note{font-size:11px;color:var(--sub);line-height:1.55;text-align:center;}
        .auth-note a{color:var(--accent);text-decoration:none;}

        @media(max-width:600px){
            .page{padding:14px 10px 70px;}
            .header-card{padding:18px 14px 16px;}
            h1{font-size:24px;}
            .search-row{flex-direction:column;}
            .guide-grid{grid-template-columns:1fr;}
            .result-item{flex-wrap:wrap;}
            .result-actions{flex-direction:column;width:100%;margin-top:10px;gap:6px;}
            .btn-mp3,.btn-mp4,.btn-play{width:100%;text-align:center;padding:8px;}
            .result-thumb,.result-thumb-ph{width:58px;height:40px;}
            #miniPlayer{bottom:10px;width:97%;}
            #authBtn{top:auto;bottom:14px;left:14px;}
        }
    </style>
</head>
<body>

<!-- Theme toggle (top-right) -->
<button id="themeToggle">&#x1F319; Mode</button>

<!-- Auth button (top-left) â€” dot turns green when linked -->
<button id="authBtn" onclick="openAuthModal()" title="YouTube Account">
    <span class="auth-dot"></span>
    <span id="authBtnLabel">YT Auth</span>
</button>

<!-- â•â• AUTH MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="authModal" onclick="onAuthModalBg(event)">
    <div class="auth-modal-box">
        <button class="auth-modal-close" onclick="closeAuthModal()">&#x2715;</button>
        <h3>&#x1F517; YouTube Account</h3>
        <p class="auth-modal-subtitle">
            Link once using a device code â€” no cookies needed.<br>
            Your token stays valid for months automatically.
        </p>

        <!-- Status pill -->
        <div class="auth-status-pill" id="authPill">
            <span class="pill-dot"></span>
            <span id="authPillText">Checkingâ€¦</span>
        </div>

        <!-- Steps (shown only during pending) -->
        <div id="authSteps">
            <div class="auth-step-row">
                <span class="auth-step-num">1</span>
                <span>On any device, open <a id="authVerifyLink" href="https://www.google.com/device" target="_blank" rel="noopener"><strong id="authVerifyUrl">google.com/device</strong></a></span>
            </div>
            <div class="auth-code-block">
                <span id="authUserCode">Â·Â·Â·Â· Â·Â·Â·Â·</span>
                <button class="auth-copy-btn" onclick="copyAuthCode()">&#x1F4CB; Copy</button>
            </div>
            <div class="auth-step-row">
                <span class="auth-step-num">2</span>
                <span>Sign in with your Google account on that page.</span>
            </div>
            <div class="auth-step-row">
                <span class="auth-step-num">3</span>
                <span>Come back here â€” this panel updates automatically when approved.</span>
            </div>
            <p class="auth-waiting">&#x23F3; Waiting for approvalâ€¦</p>
        </div>

        <!-- Buttons -->
        <div class="auth-btn-row" id="authBtnRow">
            <button class="auth-btn-primary" id="authLinkBtn" onclick="startOAuth()">&#x1F517; Link Account</button>
            <button class="auth-btn-danger"  id="authRevokeBtn" onclick="revokeOAuth()" style="display:none">&#x1F5D1; Unlink</button>
        </div>

        <p class="auth-note">
            ðŸ”’ Token stored only in server temp â€” never logged or shared.<br>
            Need the plugin? <a href="https://github.com/coletdjnz/yt-dlp-youtube-oauth2" target="_blank" rel="noopener">yt-dlp-youtube-oauth2</a>
        </p>
    </div>
</div>

<noscript><div style="text-align:center;padding:60px 20px;"><h2>Please enable JavaScript.</h2></div></noscript>

<div class="page">

    <div class="header-card">
        <a href="/" class="logo-row">
            <div id="statusDot" class="status-dot" title="Connecting..."></div>
            <h1>OmniFetch</h1>
        </a>
        <p class="tagline">Download videos &amp; music from anywhere</p>

        <div class="search-row">
            <input type="text" id="videoUrl"
                   placeholder="Paste a link  â€”orâ€”  type a song / video name..."
                   autocomplete="off" spellcheck="false" />
            <button id="clearBtn" onclick="clearInput()" title="Clear">&#x2715;</button>
            <button id="startBtn" onclick="fetchVideo()">
                <span id="btnText">Search</span>
                <div class="spinner" id="spinner"></div>
            </button>
        </div>

        <p class="hint">
            Paste a URL to download directly &nbsp;&middot;&nbsp;
            Type a name like <span>Belmont Overstepping</span> to search
        </p>

        <div class="prog-wrap" id="progressWrapper">
            <div class="prog-bar" id="progressBar"></div>
        </div>
        <p class="prog-txt" id="progressText"></p>
        <div class="error-box" id="errorBox"></div>

        <button class="share-btn" onclick="shareSite()">&#x1F517; Share OmniFetch</button>
        <span class="feedback-link" onclick="window.location='mai'+'lto:okoroike0@gm'+'ail.com?subject=OmniFetch%20Bug'">&#x2709; Report Bug / Feedback</span>
    </div>

    <!-- Search results -->
    <div id="searchResults">
        <p class="results-label" id="resultsLabel">Results</p>
        <div id="resultsList"></div>
    </div>

    <!-- Download card -->
    <div id="downloadCard">
        <div id="videoPreview"></div>
        <div class="media-title-row">
            <strong id="dlTitle">Media Title</strong>
            <span id="sourceChip"></span>
        </div>
        <p id="dlMeta"></p>
        <select id="formatSelect">
            <option value="0">&#x1F4F9; MP4 &mdash; Best Quality</option>
        </select>
        <button id="downloadBtn" onclick="triggerDownload()">&#x2B07; Download Now</button>
    </div>

    <!-- Platforms -->
    <div class="platforms">
        <span class="ptag">&#x25B6; YouTube</span>
        <span class="ptag">&#x1F3B5; TikTok</span>
        <span class="ptag">&#x1F4D8; Facebook</span>
        <span class="ptag">&#x1F4F8; Instagram</span>
        <span class="ptag">&#x1F426; Twitter/X</span>
        <span class="ptag">&#x1F3AC; Dailymotion</span>
        <span class="ptag">&#x1F3A5; Vimeo</span>
        <span class="ptag">+ more</span>
    </div>

    <!-- How it works -->
    <div class="guide">
        <h3 style="font-size:12px;color:var(--sub);margin-bottom:12px;text-transform:uppercase;letter-spacing:1px;">&#x2699; How it Works</h3>
        <div class="guide-grid">
            <div class="step"><strong>&#x1F517; Paste a Link</strong>Drop any video URL &mdash; we find every quality available.</div>
            <div class="step"><strong>&#x1F50D; Type a Name</strong>Search by song or video title, get MP3 &amp; MP4 instantly.</div>
            <div class="step"><strong>&#x1F3B5; Pick Format</strong>Choose Full HD, HD, SD video &mdash; or pure MP3 audio.</div>
            <div class="step"><strong>&#x2B07; Download</strong>Direct to your device. No ads, no sign-up required.</div>
        </div>
    </div>

    <!-- Recent history -->
    <div id="historySection">
        <div class="hist-header">
            <h3 style="font-size:12px;color:var(--sub);text-transform:uppercase;letter-spacing:1px;">&#x1F558; Recent Fetches</h3>
            <button class="clear-btn" onclick="clearHistory()">Clear All</button>
        </div>
        <div id="historyList"></div>
    </div>

</div>

<!-- Mini player -->
<div id="miniPlayer">
    <div class="mp-top">
        <span id="miniPlayerTitle">Now Playing</span>
        <button id="miniPlayerClose" onclick="closeMiniPlayer()">&#x2715;</button>
    </div>
    <div id="miniPlayerInner"></div>
</div>

<script>
    if (window._socketIOFailed || typeof io === 'undefined') {
        window.io = () => ({ on:()=>{}, emit:()=>{}, connected:false, id:'' });
    }
</script>
<script src="kizito2.js"></script>

<!-- â•â• AUTH MODAL JS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
(function() {
    // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let _pollTimer = null;

    // â”€â”€ Open / close â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.openAuthModal = function() {
        document.getElementById('authModal').classList.add('open');
        checkAuthStatus();
    };
    window.closeAuthModal = function() {
        document.getElementById('authModal').classList.remove('open');
    };
    window.onAuthModalBg = function(e) {
        if (e.target === document.getElementById('authModal')) closeAuthModal();
    };

    // â”€â”€ Render state into UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function applyStatus(data) {
        const pill      = document.getElementById('authPill');
        const pillTxt   = document.getElementById('authPillText');
        const steps     = document.getElementById('authSteps');
        const linkBtn   = document.getElementById('authLinkBtn');
        const revokeBtn = document.getElementById('authRevokeBtn');
        const authBtn   = document.getElementById('authBtn');
        const authLabel = document.getElementById('authBtnLabel');

        // Clear previous pill class
        pill.className = 'auth-status-pill';

        if (data.oauth2Linked) {
            pill.classList.add('linked');
            pillTxt.textContent = 'âœ… YouTube account linked â€” OAuth2 active. Downloads won\'t hit rate limits.';
            steps.style.display  = 'none';
            linkBtn.style.display   = 'none';
            revokeBtn.style.display = '';
            authBtn.classList.add('linked');
            authLabel.textContent = 'YT Linked';
            stopPolling();

        } else if (data.oauthFlow === 'pending' && data.userCode) {
            pill.classList.add('pending');
            pillTxt.textContent = 'Waiting for you to approve on Googleâ€¦';
            steps.style.display  = '';
            linkBtn.style.display   = 'none';
            revokeBtn.style.display = 'none';
            authBtn.classList.remove('linked');
            authLabel.textContent = 'YT Auth';
            // Show code + URL
            document.getElementById('authUserCode').textContent = data.userCode;
            const url = data.verifyUrl || 'https://www.google.com/device';
            document.getElementById('authVerifyUrl').textContent = url.replace('https://','');
            document.getElementById('authVerifyLink').href = url;
            // Keep polling
            startPolling();

        } else if (data.oauthFlow === 'error') {
            pill.classList.add('error');
            pillTxt.textContent = 'âŒ ' + (data.error || 'OAuth2 error. Is the plugin installed?');
            steps.style.display  = 'none';
            linkBtn.style.display   = '';
            linkBtn.disabled        = false;
            revokeBtn.style.display = 'none';
            authBtn.classList.remove('linked');
            authLabel.textContent = 'YT Auth';
            stopPolling();

        } else {
            // idle / not linked
            const fallback = data.cookiesLoaded ? ' (cookies fallback active)' : '';
            pillTxt.textContent = 'ðŸ”“ Not linked' + fallback + '. Link to avoid rate-limits.';
            steps.style.display  = 'none';
            linkBtn.style.display   = '';
            linkBtn.disabled        = false;
            revokeBtn.style.display = 'none';
            authBtn.classList.remove('linked');
            authLabel.textContent = 'YT Auth';
            stopPolling();
        }
    }

    // â”€â”€ Poll /api/auth/status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function checkAuthStatus() {
        try {
            const r    = await fetch('/api/auth/status');
            const data = await r.json();
            applyStatus(data);
        } catch {
            document.getElementById('authPillText').textContent = 'âš ï¸ Cannot reach server.';
        }
    }

    function startPolling() {
        if (_pollTimer) return;
        _pollTimer = setInterval(checkAuthStatus, 4000);
    }
    function stopPolling() {
        clearInterval(_pollTimer);
        _pollTimer = null;
    }

    // â”€â”€ Start OAuth flow â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.startOAuth = async function() {
        const btn = document.getElementById('authLinkBtn');
        btn.disabled = true;
        btn.textContent = 'â³ Startingâ€¦';
        document.getElementById('authPill').className = 'auth-status-pill pending';
        document.getElementById('authPillText').textContent = 'Requesting device codeâ€¦';
        try {
            const r    = await fetch('/api/auth/start', { method: 'POST' });
            const data = await r.json();
            if (!r.ok) {
                applyStatus({ oauthFlow: 'error', error: data.error });
                return;
            }
            applyStatus({ oauthFlow: 'pending', userCode: data.userCode, verifyUrl: data.verifyUrl });
        } catch {
            applyStatus({ oauthFlow: 'error', error: 'Network error â€” is the server running?' });
        }
    };

    // â”€â”€ Revoke token â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.revokeOAuth = async function() {
        if (!confirm('Unlink your YouTube account? You can re-link any time.')) return;
        try {
            await fetch('/api/auth/revoke', { method: 'POST' });
            checkAuthStatus();
        } catch {
            document.getElementById('authPillText').textContent = 'âŒ Failed to revoke.';
        }
    };

    // â”€â”€ Copy code â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.copyAuthCode = function() {
        const code = document.getElementById('authUserCode').textContent;
        navigator.clipboard.writeText(code).then(() => {
            const b = document.querySelector('.auth-copy-btn');
            if (!b) return;
            const orig = b.innerHTML;
            b.innerHTML = 'âœ… Copied!';
            setTimeout(() => { b.innerHTML = orig; }, 2000);
        });
    };

    // â”€â”€ Auto-check on load (updates button badge silently) â”€â”€
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/api/auth/status').then(r => r.json()).then(data => {
            const authBtn   = document.getElementById('authBtn');
            const authLabel = document.getElementById('authBtnLabel');
            if (data.oauth2Linked) {
                authBtn.classList.add('linked');
                authLabel.textContent = 'YT Linked';
            }
        }).catch(function(){});
    });
})();
</script>

</body>
</html>